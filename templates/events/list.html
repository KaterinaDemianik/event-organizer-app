{% extends "base.html" %}
{% block title %}–ü–æ–¥—ñ—ó ¬∑ Event Organizer{% endblock %}
{% block content %}
  <h1>–ü–æ–¥—ñ—ó</h1>

  <!-- Tabs Navigation -->
  <div class="tabs-nav">
    <a href="/?view=all" class="tab-link {% if view == 'all' or not view %}active{% endif %}">–í—Å—ñ –ø–æ–¥—ñ—ó</a>
    {% if user.is_authenticated %}
      <a href="/?view=my" class="tab-link {% if view == 'my' %}active{% endif %}">–ú–æ—ó –ø–æ–¥—ñ—ó</a>
      <a href="/?view=upcoming" class="tab-link {% if view == 'upcoming' %}active{% endif %}">–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ</a>
      <a href="/?view=archived" class="tab-link {% if view == 'archived' %}active{% endif %}">–ê—Ä—Ö—ñ–≤</a>
    {% endif %}
  </div>

  <div class="filters-card card">
    <form class="filters {% if q or status or sort != 'date' %}has-reset{% endif %}" method="get">
      <input type="hidden" name="view" value="{{ view }}" />
      <input type="search" name="q" value="{{ q }}" placeholder="–ü–æ—à—É–∫ –ø–æ–¥—ñ–π..." />
      <select name="status">
        <option value="">–°—Ç–∞—Ç—É—Å: –≤—Å—ñ</option>
        {% for val,label in status_choices %}
          <option value="{{ val }}" {% if status == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <select name="sort" aria-label="–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è" title="–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è">
        {% for option in sort_choices %}
          <option value="{{ option.slug }}" {% if sort == option.slug %}selected{% endif %}>{{ option.label }}</option>
        {% endfor %}
      </select>
      <button type="submit">–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏</button>
      {% if q or status or sort != 'date' %}
        <a role="button" class="secondary" href="/?view={{ view }}" style="height:40px; display:inline-flex; align-items:center; justify-content:center; text-decoration:none;">–°–∫–∏–Ω—É—Ç–∏</a>
      {% endif %}
    </form>
  </div>

  {% if events %}
    <div class="grid">
      {% for e in events %}
        <article class="card">
          <header class="card-head">
            <div class="card-title">
              <h3><a href="/events/{{ e.id }}/">{{ e.title }}</a></h3>
              <span class="badge {{ e.status }}">{{ e.get_status_display|default:e.status }}</span>
            </div>
            <small class="muted">{{ e.starts_at|date:"d.m.Y H:i" }} ‚Üí {{ e.ends_at|date:"d.m.Y H:i" }}</small>
            <div style="display:flex; gap:12px; flex-wrap:wrap;">
              {% if e.location %}<small class="muted">üìç {{ e.location }}</small>{% endif %}
              <small class="muted">üë§ {{ e.organizer.username }}</small>
              <small class="muted">üë• {{ e.rsvp_count }} RSVP</small>
            </div>
          </header>
          <p>{{ e.description|truncatechars:160 }}</p>
          <footer class="card-actions">
            <a role="button" href="/events/{{ e.id }}/">–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</a>
            {% if user.is_authenticated and e.organizer == user %}
              <a role="button" class="outline" href="/events/{{ e.id }}/edit/">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
            {% endif %}
          </footer>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <article class="empty">
      <p>–ü–æ–∫–∏ —â–æ –ø–æ–¥—ñ–π –Ω–µ–º–∞—î.</p>
      <a role="button" href="/events/create/">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–µ—Ä—à—É</a>
    </article>
  {% endif %}

  {% if is_paginated %}
    <nav class="pagination" aria-label="Pagination">
      <ul>
        {% if page_obj.has_previous %}
          <li><a href="?page=1{% if view %}&view={{ view }}{% endif %}{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">&laquo; –ü–µ—Ä—à–∞</a></li>
          <li><a href="?page={{ page_obj.previous_page_number }}{% if view %}&view={{ view }}{% endif %}{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">‚Üê –ü–æ–ø–µ—Ä–µ–¥–Ω—è</a></li>
        {% endif %}
        
        <li class="current">–°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page_obj.number }} –∑ {{ page_obj.paginator.num_pages }}</li>
        
        {% if page_obj.has_next %}
          <li><a href="?page={{ page_obj.next_page_number }}{% if view %}&view={{ view }}{% endif %}{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">–ù–∞—Å—Ç—É–ø–Ω–∞ ‚Üí</a></li>
          <li><a href="?page={{ page_obj.paginator.num_pages }}{% if view %}&view={{ view }}{% endif %}{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">–û—Å—Ç–∞–Ω–Ω—è &raquo;</a></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
{% endblock %}
