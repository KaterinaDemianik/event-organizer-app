{% extends "base.html" %}
{% block title %}–ü–æ–¥—ñ—ó ¬∑ Event Organizer{% endblock %}
{% block content %}
  <h1>–ü–æ–¥—ñ—ó</h1>

  <!-- Tabs Navigation -->
  <div class="tabs-nav">
    <a href="/?view=all" class="tab-link {% if view == 'all' or not view %}active{% endif %}">–í—Å—ñ –ø–æ–¥—ñ—ó</a>
    {% if user.is_authenticated %}
      <a href="/?view=my" class="tab-link {% if view == 'my' %}active{% endif %}">–ú–æ—ó –ø–æ–¥—ñ—ó</a>
      <a href="/?view=upcoming" class="tab-link {% if view == 'upcoming' %}active{% endif %}">–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ</a>
      <a href="/?view=archived" class="tab-link {% if view == 'archived' %}active{% endif %}">–ê—Ä—Ö—ñ–≤</a>
    {% endif %}
  </div>

  <div class="filters-card card">
    <form method="get">
      <input type="hidden" name="view" value="{{ view }}" />
      
      <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 12px; align-items: end;">
        <div>
          <label style="font-size: 13px; font-weight: 600; color: var(--muted); margin-bottom: 6px; display: block; min-height: 20px;">üîç –ü–æ—à—É–∫</label>
          <input type="search" name="q" value="{{ q }}" placeholder="–ü–æ—à—É–∫..." />
        </div>
        
        <div>
          <label style="font-size: 13px; font-weight: 600; color: var(--muted); margin-bottom: 6px; display: block; min-height: 20px;">üìä –°—Ç–∞—Ç—É—Å</label>
          <select name="status">
            <option value="">–í—Å—ñ</option>
            {% for val,label in status_choices %}
              <option value="{{ val }}" {% if status == val %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>
        
        <div>
          <label style="font-size: 13px; font-weight: 600; color: var(--muted); margin-bottom: 6px; display: block; min-height: 20px;">üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
          <input type="search" name="category" value="{{ category }}" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü—ñ—è, –≤–µ–±—ñ–Ω–∞—Ä" />
        </div>
        
        <div>
          <label style="font-size: 13px; font-weight: 600; color: var(--muted); margin-bottom: 6px; display: block; min-height: 20px;">üìÖ –î–∞—Ç–∞</label>
          <select name="date_filter">
            <option value="">–í—Å—ñ</option>
            <option value="upcoming" {% if date_filter == 'upcoming' %}selected{% endif %}>–ú–∞–π–±—É—Ç–Ω—ñ</option>
            <option value="today" {% if date_filter == 'today' %}selected{% endif %}>–°—å–æ–≥–æ–¥–Ω—ñ</option>
            <option value="this_week" {% if date_filter == 'this_week' %}selected{% endif %}>–¶–µ–π —Ç–∏–∂–¥–µ–Ω—å</option>
            <option value="this_month" {% if date_filter == 'this_month' %}selected{% endif %}>–¶–µ–π –º—ñ—Å—è—Ü—å</option>
          </select>
        </div>
        
        <div>
          <label style="font-size: 13px; font-weight: 600; color: var(--muted); margin-bottom: 6px; display: block; min-height: 20px;">üìà –ü–æ–ø—É–ª—è—Ä–Ω—ñ—Å—Ç—å</label>
          <select name="popularity">
            <option value="">–í—Å—ñ</option>
            <option value="popular" {% if popularity == 'popular' %}selected{% endif %}>–ü–æ–ø—É–ª—è—Ä–Ω—ñ (5+)</option>
            <option value="medium" {% if popularity == 'medium' %}selected{% endif %}>–°–µ—Ä–µ–¥–Ω—ñ (1-4)</option>
            <option value="none" {% if popularity == 'none' %}selected{% endif %}>–ë–µ–∑ RSVP</option>
          </select>
        </div>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr auto; gap: 12px;">
        <div>
          <label style="font-size: 13px; font-weight: 600; color: var(--muted); margin-bottom: 6px; display: block; min-height: 20px;">üîÑ –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è</label>
          <select name="sort">
            <option value="date" {% if sort == 'date' or not sort %}selected{% endif %}>–ó–∞ –¥–∞—Ç–æ—é —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è</option>
            <option value="popular" {% if sort == 'popular' %}selected{% endif %}>–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—ñ</option>
            <option value="alphabet" {% if sort == 'alphabet' %}selected{% endif %}>–ó–∞ –∞–ª—Ñ–∞–≤—ñ—Ç–æ–º</option>
            <option value="event_date" {% if sort == 'event_date' %}selected{% endif %}>–ü–æ –¥–∞—Ç—ñ –ø–æ–¥—ñ—ó</option>
            <option value="rsvp_count" {% if sort == 'rsvp_count' %}selected{% endif %}>–ü–æ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ RSVP</option>
          </select>
        </div>
        
        <div style="display: flex; gap: 8px; padding-top: 26px;">
          <button type="submit">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
          {% if q or status or category or date_filter or popularity or sort != 'date' %}
            <a role="button" class="secondary" href="/events/?view={{ view }}">–°–∫–∏–Ω—É—Ç–∏</a>
          {% endif %}
        </div>
      </div>
    </form>
  </div>
  
  {% if popular_tags %}
    <div class="popular-tags" style="margin: 12px 0 20px 0; display: flex; flex-wrap: wrap; gap: 8px; align-items: center;">
      <span style="font-size: 13px; color: var(--muted);">–ü–æ–ø—É–ª—è—Ä–Ω—ñ —Ç–µ–≥–∏:</span>
      <form method="get" style="display: flex; flex-wrap: wrap; gap: 8px; margin: 0;">
        <input type="hidden" name="view" value="{{ view }}" />
        {% if q %}<input type="hidden" name="q" value="{{ q }}" />{% endif %}
        {% if status %}<input type="hidden" name="status" value="{{ status }}" />{% endif %}
        {% if date_filter %}<input type="hidden" name="date_filter" value="{{ date_filter }}" />{% endif %}
        {% if popularity %}<input type="hidden" name="popularity" value="{{ popularity }}" />{% endif %}
        {% if sort %}<input type="hidden" name="sort" value="{{ sort }}" />{% endif %}
        {% for tag in popular_tags %}
          <button type="submit" name="category" value="{{ tag.slug }}" class="tag-pill{% if category == tag.slug %} active{% endif %}"># {{ tag.label }} ({{ tag.count }})</button>
        {% endfor %}
      </form>
    </div>
  {% endif %}

  {% if events %}
    <div class="grid">
      {% for e in events %}
        <article class="card">
          <header class="card-head">
            <div class="card-title">
              <h3><a href="/events/{{ e.id }}/">{{ e.title }}</a></h3>
              <span class="badge {{ e.status }}">{{ e.get_status_display|default:e.status }}</span>
            </div>
            <small class="muted">{{ e.starts_at|date:"d.m.Y H:i" }} ‚Üí {{ e.ends_at|date:"d.m.Y H:i" }}</small>
            <div style="display:flex; gap:12px; flex-wrap:wrap;">
              {% if e.location %}<small class="muted">üìç {{ e.location }}</small>{% endif %}
              <small class="muted">üë§ {{ e.organizer.username }}</small>
              {% if e.category %}<small class="muted">üè∑Ô∏è {{ e.category }}</small>{% endif %}
              <small class="muted">üë• {{ e.rsvp_count }} RSVP</small>
            </div>
          </header>
          <p>{{ e.description|truncatechars:160 }}</p>
          <footer class="card-actions">
            <a role="button" href="/events/{{ e.id }}/">–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</a>
            {% if user.is_authenticated %}
              {% if e.organizer == user or user.is_staff %}
                <a role="button" class="outline" href="/events/{{ e.id }}/edit/">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
              {% endif %}
            {% endif %}
          </footer>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <article class="empty">
      <p>–ü–æ–∫–∏ —â–æ –ø–æ–¥—ñ–π –Ω–µ–º–∞—î.</p>
      <a role="button" href="/events/create/">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–µ—Ä—à—É</a>
    </article>
  {% endif %}

  {% if is_paginated %}
    <nav class="pagination" aria-label="Pagination">
      <ul>
        {% if page_obj.has_previous %}
          <li><a href="?page=1{% if view %}&view={{ view }}{% endif %}{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">&laquo; –ü–µ—Ä—à–∞</a></li>
          <li><a href="?page={{ page_obj.previous_page_number }}{% if view %}&view={{ view }}{% endif %}{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">‚Üê –ü–æ–ø–µ—Ä–µ–¥–Ω—è</a></li>
        {% endif %}
        
        <li class="current">–°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page_obj.number }} –∑ {{ page_obj.paginator.num_pages }}</li>
        
        {% if page_obj.has_next %}
          <li><a href="?page={{ page_obj.next_page_number }}{% if view %}&view={{ view }}{% endif %}{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">–ù–∞—Å—Ç—É–ø–Ω–∞ ‚Üí</a></li>
          <li><a href="?page={{ page_obj.paginator.num_pages }}{% if view %}&view={{ view }}{% endif %}{% if q %}&q={{ q }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">–û—Å—Ç–∞–Ω–Ω—è &raquo;</a></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
{% endblock %}
