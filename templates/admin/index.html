{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<h2> –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–Ω–µ–ª—å</h2>

<style>
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin: 24px 0;
}
.stat-card {
  background: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 20px;
}
.stat-card h3 {
  margin: 0 0 12px 0;
  font-size: 14px;
  color: #666;
  font-weight: 600;
}
.stat-number {
  font-size: 32px;
  font-weight: 700;
  color: #417690;
  margin: 8px 0;
}
.stat-details {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-top: 12px;
  font-size: 12px;
  color: #666;
}
.admin-section {
  margin: 32px 0;
  background: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,.1);
}
.admin-section h2 {
  margin: 0 0 16px 0;
  font-size: 18px;
  color: #333;
}
.admin-section table {
  width: 100%;
}
.admin-section table th {
  text-align: left;
  padding: 8px;
  background: #f8f9fa;
  font-size: 13px;
}
.admin-section table td {
  padding: 8px;
  border-top: 1px solid #dee2e6;
  font-size: 13px;
}
.badge {
  display: inline-block;
  padding: 3px 8px;
  font-size: 11px;
  border-radius: 12px;
  font-weight: 600;
}
.badge.published { background: #d1ecf1; color: #0c5460; }
.badge.draft { background: #fff3cd; color: #856404; }
.badge.cancelled { background: #f8d7da; color: #721c24; }
.badge.archived { background: #e2e3e5; color: #383d41; }
</style>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="stats-grid">
  <div class="stat-card">
    <h3>–ü–æ–¥—ñ—ó</h3>
    <div class="stat-number">{{ total_events }}</div>
    <div class="stat-details">
      <span>–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ: {{ published_events }}</span>
      <span>–ú–∞–π–±—É—Ç–Ω—ñ: {{ upcoming_events }}</span>
      <span>–í –∞—Ä—Ö—ñ–≤—ñ: {{ archived_events }}</span>
    </div>
  </div>

  <div class="stat-card">
    <h3>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</h3>
    <div class="stat-number">{{ total_users }}</div>
    <div class="stat-details">
      <span>–ù–æ–≤–∏—Ö –∑–∞ —Ç–∏–∂–¥–µ–Ω—å: +{{ new_users_week }}</span>
      <span>–ù–æ–≤–∏—Ö –∑–∞ –º—ñ—Å—è—Ü—å: +{{ new_users_month }}</span>
    </div>
  </div>

  <div class="stat-card">
    <h3>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó (RSVP)</h3>
    <div class="stat-number">{{ total_rsvps }}</div>
    <div class="stat-details">
      <span>–ó–∞ —Ç–∏–∂–¥–µ–Ω—å: +{{ rsvps_week }}</span>
      <span>–ó–∞ –º—ñ—Å—è—Ü—å: +{{ rsvps_month }}</span>
    </div>
  </div>
</div>

<!-- –¢–æ–ø –ø–æ–¥—ñ—ó -->
<div class="admin-section">
  <h2>–¢–æ–ø –ø–æ–¥—ñ—ó –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—ñ</h2>
  <table>
    <thead>
      <tr>
        <th>–ù–∞–∑–≤–∞</th>
        <th>–û—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>RSVP</th>
        <th>–î–∞—Ç–∞</th>
      </tr>
    </thead>
    <tbody>
      {% for event in top_events %}
        <tr>
          <td><a href="/events/{{ event.id }}/" target="_blank">{{ event.title }}</a></td>
          <td>{{ event.organizer.username }}</td>
          <td><span class="badge {{ event.status }}">{{ event.get_status_display }}</span></td>
          <td><strong>{{ event.rsvp_count }}</strong></td>
          <td>{{ event.starts_at|date:"d.m.Y" }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- –û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–¥—ñ—ó -->
<div class="admin-section">
  <h2>üÜï –û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–¥—ñ—ó</h2>
  <table>
    <thead>
      <tr>
        <th>–ù–∞–∑–≤–∞</th>
        <th>–û—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–°—Ç–≤–æ—Ä–µ–Ω–æ</th>
        <th>–î—ñ—ó</th>
      </tr>
    </thead>
    <tbody>
      {% for event in recent_events %}
        <tr>
          <td><a href="/events/{{ event.id }}/" target="_blank">{{ event.title }}</a></td>
          <td>{{ event.organizer.username }}</td>
          <td><span class="badge {{ event.status }}">{{ event.get_status_display }}</span></td>
          <td>{{ event.created_at|date:"d.m.Y H:i" }}</td>
          <td><a href="{% url 'admin:events_event_change' event.id %}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- –û—Å—Ç–∞–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ -->
<div class="admin-section">
  <h2>üë• –ù–æ–≤—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</h2>
  <table>
    <thead>
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</th>
        <th>–î—ñ—ó</th>
      </tr>
    </thead>
    <tbody>
      {% for user in recent_users %}
        <tr>
          <td><strong>{{ user.username }}</strong></td>
          <td>{{ user.email }}</td>
          <td>{{ user.date_joined|date:"d.m.Y H:i" }}</td>
          <td><a href="{% url 'admin:auth_user_change' user.id %}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- –û—Å—Ç–∞–Ω–Ω—ñ RSVP -->
<div class="admin-section">
  <h2>üìù –û—Å—Ç–∞–Ω–Ω—ñ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</h2>
  <table>
    <thead>
      <tr>
        <th>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</th>
        <th>–ü–æ–¥—ñ—è</th>
        <th>–î–∞—Ç–∞</th>
      </tr>
    </thead>
    <tbody>
      {% for rsvp in recent_rsvps %}
        <tr>
          <td>{{ rsvp.user.username }}</td>
          <td><a href="/events/{{ rsvp.event.id }}/" target="_blank">{{ rsvp.event.title }}</a></td>
          <td>{{ rsvp.created_at|date:"d.m.Y H:i" }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
