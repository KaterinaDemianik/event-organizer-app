{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<h2> Адміністративна панель</h2>

<style>
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin: 24px 0;
}
.stat-card {
  background: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 20px;
}
.stat-card h3 {
  margin: 0 0 12px 0;
  font-size: 14px;
  color: #666;
  font-weight: 600;
}
.stat-number {
  font-size: 32px;
  font-weight: 700;
  color: #417690;
  margin: 8px 0;
}
.stat-details {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-top: 12px;
  font-size: 12px;
  color: #666;
}
.admin-section {
  margin: 32px 0;
  background: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,.1);
}
.admin-section h2 {
  margin: 0 0 16px 0;
  font-size: 18px;
  color: #333;
}
.admin-section table {
  width: 100%;
}
.admin-section table th {
  text-align: left;
  padding: 8px;
  background: #f8f9fa;
  font-size: 13px;
}
.admin-section table td {
  padding: 8px;
  border-top: 1px solid #dee2e6;
  font-size: 13px;
}
.badge {
  display: inline-block;
  padding: 3px 8px;
  font-size: 11px;
  border-radius: 12px;
  font-weight: 600;
}
.badge.published { background: #d1ecf1; color: #0c5460; }
.badge.draft { background: #fff3cd; color: #856404; }
.badge.cancelled { background: #f8d7da; color: #721c24; }
.badge.archived { background: #e2e3e5; color: #383d41; }
</style>


<div class="stats-grid">
  <div class="stat-card">
    <h3>Події</h3>
    <div class="stat-number">{{ total_events }}</div>
    <div class="stat-details">
      <span>Опубліковано: {{ published_events }}</span>
      <span>Майбутні: {{ upcoming_events }}</span>
      <span>В архіві: {{ archived_events }}</span>
    </div>
  </div>

  <div class="stat-card">
    <h3>Користувачі</h3>
    <div class="stat-number">{{ total_users }}</div>
    <div class="stat-details">
      <span>Нових за тиждень: +{{ new_users_week }}</span>
      <span>Нових за місяць: +{{ new_users_month }}</span>
    </div>
  </div>

  <div class="stat-card">
    <h3>Реєстрації (RSVP)</h3>
    <div class="stat-number">{{ total_rsvps }}</div>
    <div class="stat-details">
      <span>За тиждень: +{{ rsvps_week }}</span>
      <span>За місяць: +{{ rsvps_month }}</span>
    </div>
  </div>
</div>


<div class="admin-section">
  <h2>Топ події по популярності</h2>
  <table>
    <thead>
      <tr>
        <th>Назва</th>
        <th>Організатор</th>
        <th>Статус</th>
        <th>RSVP</th>
        <th>Дата</th>
      </tr>
    </thead>
    <tbody>
      {% for event in top_events %}
        <tr>
          <td><a href="/events/{{ event.id }}/" target="_blank">{{ event.title }}</a></td>
          <td>{{ event.organizer.username }}</td>
          <td><span class="badge {{ event.status }}">{{ event.get_status_display }}</span></td>
          <td><strong>{{ event.rsvp_count }}</strong></td>
          <td>{{ event.starts_at|date:"d.m.Y" }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


<div class="admin-section">
  <h2>Останні події</h2>
  <table>
    <thead>
      <tr>
        <th>Назва</th>
        <th>Організатор</th>
        <th>Статус</th>
        <th>Створено</th>
        <th>Дії</th>
      </tr>
    </thead>
    <tbody>
      {% for event in recent_events %}
        <tr>
          <td><a href="/events/{{ event.id }}/" target="_blank">{{ event.title }}</a></td>
          <td>{{ event.organizer.username }}</td>
          <td><span class="badge {{ event.status }}">{{ event.get_status_display }}</span></td>
          <td>{{ event.created_at|date:"d.m.Y H:i" }}</td>
          <td><a href="{% url 'admin:events_event_change' event.id %}">Редагувати</a></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


<div class="admin-section">
  <h2>Нові користувачі</h2>
  <table>
    <thead>
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Дата реєстрації</th>
        <th>Дії</th>
      </tr>
    </thead>
    <tbody>
      {% for user in recent_users %}
        <tr>
          <td><strong>{{ user.username }}</strong></td>
          <td>{{ user.email }}</td>
          <td>{{ user.date_joined|date:"d.m.Y H:i" }}</td>
          <td><a href="{% url 'admin:auth_user_change' user.id %}">Редагувати</a></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


<div class="admin-section">
  <h2>Останні реєстрації</h2>
  <table>
    <thead>
      <tr>
        <th>Користувач</th>
        <th>Подія</th>
        <th>Дата</th>
      </tr>
    </thead>
    <tbody>
      {% for rsvp in recent_rsvps %}
        <tr>
          <td>{{ rsvp.user.username }}</td>
          <td><a href="/events/{{ rsvp.event.id }}/" target="_blank">{{ rsvp.event.title }}</a></td>
          <td>{{ rsvp.created_at|date:"d.m.Y H:i" }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
